var Chunk=function(resource,connections,callback){"object"==typeof connections?(void 0==connections[1]?(this.len(resource),this.initialize(1,0,this.size-connections[0]+1)):this.initialize(1,0,connections[1]-connections[0]+1),this.start_point=connections[0],this.end_point=connections[1]):(this.initialize(connections,0,0),this.len(resource)),this.source=resource,this.each_chunk_callback=callback};Chunk.prototype.initialize=function(connections,chunk,size){this.connections=connections,this.chunk=chunk,this.size=size},Chunk.prototype.len=function(resource){var http=new XMLHttpRequest;http.open("HEAD",resource,!1),http.setRequestHeader("Accept","*"),http.onreadystatechange=function(){http.readyState==http.DONE&&(length=http.getResponseHeader("Content-Length"),this.size=length)}.bind(this),http.send()},Chunk.prototype.download=function(){void 0!=this.start_point?this.get_part(this.start_point,this.end_point,0):this.download_from_connections()},Chunk.prototype.download_from_connections=function(){var length=this.size,difference=Math.floor(length/this.connections),modulo=difference%3;0==modulo?difference-=1:modulo%3==1&&(difference-=2);var start_point=0,i=0;for(i=1;length/difference-1>=i;start_point=end_point+1,i++)end_point=start_point+difference,this.get_part(start_point,end_point,i);return this.get_part(start_point,length-1,i),!0},Chunk.prototype.get_part=function(start_index,end_index,chunk_index){console.log("bytes="+start_index+"-"+end_index);var xmlhttp=new XMLHttpRequest;xmlhttp.open("GET",this.source,!0),xmlhttp.responseType="arraybuffer",xmlhttp.setRequestHeader("Range","bytes="+start_index+"-"+end_index),xmlhttp.addEventListener("readystatechange",function(){xmlhttp.readyState==xmlhttp.DONE&&this.each_chunk_callback(this.connections,new Uint8Array(xmlhttp.response),"chunk"+chunk_index)}.bind(this)),xmlhttp.send()};